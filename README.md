# REFORMERS Digital Twin Model API Server

## Overview

This package implements the server for REFORMERS Digital Twin Model API, according to the dedicated [OpenAPI specification](https://github.com/REFORMERS-EnergyValleys/reformers-dt-model-api-specs).
It is developed on top of stubs generated by the [OpenAPI Generator](https://openapi-generator.tech), see [here](./GENERATOR.md) for more details.

_Funding acknowledgement_:
The [REFORMERS project](https://reformers-energyvalleys.eu) has received funding from the European Unionâ€™s research and innovation programme Horizon Europe under the [Grant Agreement No.101136211](https://cordis.europa.eu/project/id/101136211)


## Requirements
Python 3.5.2+

## Usage

To run the server, please execute the following from the root directory:

```
pip3 install -r requirements.txt
python3 -m reformers_model_api_server
```

*Options*: provide as command line arguments

+ `-s TEXT`, `--specification TEXT`: OpenAPI specification file name
+ `-h TEXT`, `--host TEXT`: URL to repository
+ `-a TEXT`, `--auth-config TEXT`: path to authentication config file (see [`auth-config.json`](./auth-config.json) for an example)
+ `--remove-containers BOOLEAN`: set this to false to remove containers after they have exited
+ `--verify-ssl BOOLEAN` set this to false to skip verifying SSL certificates
+ `--help`: show help message and exit

**NOTE**:
For the server to start-up, the repository as defined via `-h` / `--host` must be reachable.

Open your browser to here:

```
http://localhost:8080/api/ui/
```

The OpenAPI definition lives here:

```
http://localhost:8080/api/openapi.json
```

## Running with Docker

Build container image using a [Waitress WSGI server](https://docs.pylonsproject.org/projects/waitress/en/latest/) for the deployment of the Model API server:
```sh
docker build -t reformers-energyvalleys/model-api-server .
```

To run the server in a Docker container, execute the following from the root directory:

Linux:
```bash
docker run --rm -d -p 8080:80 -v /var/run/docker.sock:/var/run/docker.sock -v $PWD/auth-config.json:/auth-config.json -e REGISTRY_AUTH_CONFIG=$PWD/auth-config.json reformers-energyvalleys/model-api-server
```

Windows:
```cmd
docker run --rm -d -p 8080:80 -v /var/run/docker.sock:/var/run/docker.sock -v %CD%\auth-config.json:/auth-config.json -e REGISTRY_AUTH_CONFIG=%CD%\auth-config.json reformers-energyvalleys/model-api-server
```

*Options*: can be set as as environment variables for the container (flag `-e` / `--env`)

+ `SPECIFICATION`: OpenAPI specification file name
+ `HOST`: URL to repository
+ `REGISTRY_AUTH_CONFIG`: path to authentication config file for accessing the container registries
+ `REPO_AUTH_CONFIG`: path to authentication config file for accessing the repository
+ `REMOVE_CONTAINERS`: set this to `false` (or `0`) to remove containers after they have exited
+ `VERIFY_SSL`: set this to `false` (or `0`) to skip verifying SSL certificates
